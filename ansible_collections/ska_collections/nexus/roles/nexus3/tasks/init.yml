---
- name: Install JDK 1.8
  ansible.builtin.apt:
    name: "openjdk-8-jre-headless"
    update_cache: true
    state: present
  register: apt_res
  retries: 30
  delay: 30
  until: apt_res is success

- name: Install rsync
  ansible.builtin.apt:
    name: "rsync"
    update_cache: true
    install_recommends: false
    state: present
  register: apt_res
  retries: 30
  delay: 30
  until: apt_res is success

- name: "Install {{ nexus_ntp_service }}"
  ansible.builtin.apt:
    name: "{{ nexus_ntp_service }}"
    update_cache: true
    install_recommends: false
    state: present
  register: apt_res
  retries: 30
  delay: 30
  until: apt_res is success

- name: "Enable service {{ nexus_ntp_service }}"
  ansible.builtin.service:
    name: "{{ nexus_ntp_service }}"
    enabled: true

- name: Make sure the NTP service is stopped
  ansible.builtin.service:
    name: "{{ nexus_ntp_service }}"
    state: stopped

- name: Force NTP sync
  ansible.builtin.command: "/usr/sbin/chronyd -q"
  changed_when: false

- name: Start the NTP service
  ansible.builtin.service:
    name: "{{ nexus_ntp_service }}"
    state: started
    enabled: true

- name: Flush handlers
  ansible.builtin.meta: flush_handlers
