#!/usr/bin/env ansible-playbook
---

- name: Ensure that the apt repositories are updated
  hosts: "{{ target_hosts }}"
  vars:
    target_hosts: localhost
  become: true
  tasks:
    - name: Ensure that the apt cache is updated
      ansible.builtin.apt:
        update_cache: true
      register: apt_res
      retries: 5
      until: apt_res is success
      when: ansible_os_family == "Debian"

- name: Apply the containerd role
  hosts: "{{ target_hosts }}"
  vars:
    target_hosts: localhost
  become: true
  roles:
    - ska_collections.docker_base.containerd

- name: "Apply the clusterapi containerd config role to nodes"
  hosts: "{{ target_hosts }}"
  vars:
    target_hosts: localhost
  roles:
    - ska_collections.clusterapi.containerd
