#!/usr/bin/env ansible-playbook
---
- name: Show debug info
  hosts: "{{ target_hosts }}"
  become: true
  tasks:
    - name: "Show stack nodes info"
      ansible.builtin.debug: var=hostvars[inventory_hostname]
      when: debug

- name: "Ensure that the apt repositories are updated - old image issues"
  hosts: "{{ target_hosts }}"
  become: true
  tasks:
    - name: Ensure that the apt cache is updated
      apt:
        update_cache: true
      register: apt_res
      retries: 5
      until: apt_res is success

- name: "Apply the docker role to the docker nodes"
  hosts: "{{ target_hosts }}"
  become: true
  roles:
    - docker
