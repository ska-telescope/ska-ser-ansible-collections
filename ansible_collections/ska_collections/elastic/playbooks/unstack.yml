#!/usr/bin/env ansible-playbook
---

- name: "Remove containers"
  hosts: cluster
  become: yes

  vars_files:
    - roles/stack/defaults/main.yml
    - roles/logging/defaults/main.yml

  tasks:
    - name: "Show ireallymeanit"
      debug: var=ireallymeanit

    - name: exit playbook, if user did not mean to tear down ElasticStack
      fail:
        msg: >
          "Exiting teardown playbook. To really do it, either
          say 'yes' on the prompt or use `-e ireallymeanit=yes`
          on the command line when invoking the playbook"
      when: ireallymeanit != 'yes'

    - name: "Show stack nodes info"
      debug: var=hostvars[inventory_hostname]
      when: debug

    - name: elk remove containers
      docker_container:
        name: "{{ item }}"
        state: absent
        stop_timeout: 60
        timeout: 120
        force_kill: no
      with_items:
        - elk_elasticsearch
        - elk_kibana
        - "{{ eexporter_name }}"
        - "{{ filebeat_name }}"

    - name: "Recursively remove {{ data_filesystem }} directory"
      file:
        path: "{{ data_filesystem }}"
        state: absent
