#!/usr/bin/env ansible-playbook
- name: Thanos query frontend health check
  hosts: lewisvm
  become: true
  tasks:
  - name: Thanos query frontend responds with HTTP 200 in response to health check request
    ansible.builtin.uri:
      url: "https://{{ hostvars[inventory_hostname].ip }}:{{ thanos_query_frontend_port }}/-/healthy"
      method: GET
      force: yes
      return_content: yes
      status_code: [200]
      client_cert: "{{ certificates_dir }}/thanos_query_frontend.crt"
      client_key: "{{ certificates_dir }}/thanos_query_frontend.key"
    environment:
      SSL_CERT_FILE: "{{ certificates_dir }}/ca-certificate.crt"