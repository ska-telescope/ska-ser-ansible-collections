---
- name: Deploy monitoring solution
  hosts: "{{ target_hosts }}"
  vars:
    target_hosts: localhost
    mode: "all"
  become: true
  become_method: sudo
  become_flags: '-S -n'
  tasks:
    - name: Include node exporter role
      ansible.builtin.include_role:
        name: node_exporter
      when: mode == "exporter" or mode == "all"
  roles:
    - updatehosts
    - prometheus
