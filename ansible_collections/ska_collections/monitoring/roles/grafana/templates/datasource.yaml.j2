apiVersion: 1

# list of datasources that should be deleted from the database
deleteDatasources:
  - name: '{{ prometheus_grafana_datasource }}'
    orgId: 1

# list of datasources to insert/update depending
# what's available in the database
datasources:
  # <string, required> name of the datasource. Required
- name: '{{ prometheus_grafana_datasource }}'
  type: 'prometheus'
  access: 'proxy'
  orgId: 1
{% if hostvars[prometheus_thanos_query_frontend] is defined %}
  url: https://{{ hostvars[prometheus_thanos_query_frontend].ip }}:9095
{% else %}
  url: https://{{ ansible_fqdn | default(ansible_host) | default('localhost') }}:9095
{% endif %}
  basicAuth: false
  isDefault: true
  editable: false
  jsonData:
    editable: false
    httpMode: POST
    tlsSkipVerify: true
    timeInterval: "1m"
- name: 'InfluxDBInfluxQL'
  type: 'influxdb'
  access: 'proxy'
  url: http://{{ prometheus_grafana_influxdb | default(ansible_host) | default('localhost') }}:8086
  database: {{ prometheus_grafana_influxdb_db }}
  basicAuth: false
  isDefault: false
  editable: false
  jsonData:
    httpMode: POST
    version: InfluxQL
- name: 'InfluxDBFlux'
  type: 'influxdb'
  access: 'proxy'
  url: http://{{ prometheus_grafana_influxdb | default(ansible_host) | default('localhost') }}:8086
  basicAuth: false
  isDefault: false
  secureJsonData:
    token: "test:test"
  jsonData:
    editable: false
    httpMode: POST
    version: Flux
    organization: "non-empty"
    defaultBucket: {{ prometheus_grafana_influxdb_db }}/autogen
    tlsSkipVerify: true
    timeInterval: "1m"
