---
- name: Set variable
  ansible.builtin.debug: var=ansible_default_ipv4.address

- name: Set hostname
  ansible.builtin.debug: var=ansible_hostname

- name: "Build hosts file"
  ansible.builtin.lineinfile:
    path: /etc/hosts
    regexp: '.*{{ ansible_hostname }}'
    line: "{{ ansible_default_ipv4.address }} {{ ansible_hostname }}"
    state: present
  when:
    - ansible_default_ipv4 is defined
