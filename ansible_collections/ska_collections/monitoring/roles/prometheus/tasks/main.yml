---

- name: Task grafana_ceph
  ansible.builtin.include_tasks: blackbox_exporter.yml
  when: mode == "server" or mode == "all"

- name: Task runner_exporter
  ansible.builtin.include_tasks: runner_exporter.yml
  when: mode == "runner"

- name: Task docker_exporter
  ansible.builtin.include_tasks: docker_exporter.yml
  when: mode == "docker"

- name: Task grafana_ceph
  ansible.builtin.include_tasks: grafana_ceph.yml
  when: mode == "grafana" or mode == "server" or mode == "all"

- name: Task grafana_elasticstack
  ansible.builtin.include_tasks: grafana_elasticstack.yml
  when: mode == "grafana" or mode == "server" or mode == "all"

- name: Task grafana_kubernetes
  ansible.builtin.include_tasks: grafana_kubernetes.yml
  when: mode == "grafana" or mode == "server" or mode == "all"

- name: Task grafana_gitlab_runners
  ansible.builtin.include_tasks: grafana_gitlab_runners.yml
  when: mode == "grafana" or mode == "server" or mode == "all"

- name: Task grafana_cadvisor
  ansible.builtin.include_tasks: grafana_cadvisor.yml
  when: mode == "grafana" or mode == "server" or mode == "all"

- name: Task grafana_nodexporter
  ansible.builtin.include_tasks: grafana_nodexporter.yml
  when: mode == "grafana" or mode == "server" or mode == "all"

- name: Task gitlab_ci_pipelines_exporter
  ansible.builtin.include_tasks: gitlab_ci_pipelines_exporter.yml
  when: mode == "server" or mode == "all"

- name: Task grafana_alerts
  ansible.builtin.include_tasks: grafana_alerts.yml
  when: mode == "grafana" or mode == "server" or mode == "all"

# launch prom/alert/grafana after configuration
- name: Task server
  ansible.builtin.include_tasks: server.yml
  when: mode == "server" or mode == "all"
  tags:
    - cron

- name: Task thanos_sidecar
  ansible.builtin.include_tasks: thanos_sidecar.yml
  when: mode == "server" or mode == "all"
  tags:
    - cron

- name: Task thanos_query
  ansible.builtin.include_tasks: thanos_query.yml
  when: mode == "thanos" or mode == "all"
  tags:
    - cron

- name: Task prometheus_thanos_query_frontend
  ansible.builtin.include_tasks: thanos_query_frontend.yml
  when: mode == "thanos" or mode == "all"
  tags:
    - cron

- name: Task thanos_store
  ansible.builtin.include_tasks: thanos_store.yml
  when: mode == "thanos" or mode == "all"
  tags:
    - cron

- name: Thanos_compactor task
  ansible.builtin.include_tasks: thanos_compactor.yml
  when: mode == "thanos" or mode == "all"
  tags:
    - cron

- name: Alert_manager task
  ansible.builtin.include_tasks: alert_manager.yml
  when: mode == "alert" or mode == "server" or mode == "all"
  tags:
    - cron

- name: Grafana task
  ansible.builtin.include_tasks: grafana.yml
  when: mode == "grafana" or mode == "server" or mode == "all"
  tags:
    - cron
